#!/bin/sh -e

text="$1"
text2="$2"
bg="$3"
out=$4
res=1200x628

tmp=$(mktemp -d)

# TODO
# numbers still need to be tweaked

if [[ "$bg" == "" ]]; then
  bg="#2421AB"
  convert -size $res xc:$bg $tmp/bg.png
else
  convert $bg -resize $res^ $tmp/bg-uncropped.png
  convert $tmp/bg-uncropped.png -gravity center -crop $res+0+0 -fill black -colorize 40% $tmp/bg.png
fi

convert -size $res xc:"#00000000" \
  -font "Montserrat-Light" \
  -pointsize 100 -fill white -draw 'text 100,160 "Blog Post" ' \
  $tmp/text-top.png

convert -size $res xc:"#00000000" \
  -font "Montserrat-Medium" \
  -pointsize 95 -fill white -draw "text 100,785 '$text' " \
  $tmp/text-bottom.png

convert -size $res xc:"#00000000" \
  -font "Montserrat-Medium" \
  -pointsize 95 -fill white -draw "text 100,975 '$text2' " \
  $tmp/text-bottom-2.png

convert \
  -page +0+0 $tmp/bg.png \
  -page +0+0 $tmp/text-top.png \
  -page +0+0 $tmp/text-bottom.png \
  -page +0+0 $tmp/text-bottom-2.png \
  -layers merge +repage $out

image_optim $out
